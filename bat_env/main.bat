
color b
title 定时删除过期的备份日志
@echo off
cls 

@ ECHO.
@ ECHO.				   说  明
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.				  通用主程序    
@ ECHO.			Creat by Sunhm@20170621
@ ECHO.-------------------------------------------------------------------------------

Rem 设置当前日期
set GlobalToday=%date:~0,4%%date:~5,2%%date:~8,2%

@ ECHO.				开始检查系统参数
@ ECHO.-------------------------------------------------------------------------------
Rem 判断参数是否存在
 if exist  %~dp0\env.txt (echo Start Programe!) else (echo 请检查参数文件,确保env.txt在目录地下 && pause && exit)
 
Rem 判断blat是否存在
if exist  %windir%/system32\blat.exe (echo 邮箱 blat 正常!!) else (copy %Global_Bat_HOME%\tools\blat.exe %windir%\system32\)
if exist  %windir%/system32\blat.dll (echo 邮箱 blat 正常!!) else (copy %Global_Bat_HOME%\tools\blat.dll %windir%\system32\)

Rem 读取参数
for /f "tokens=1,2 delims==" %%i in ('type %~dp0\env.txt^|findstr "="') do (
set %%i=%%j
)

@ ECHO.				开始调用子程序
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.				开始清除SAP数据备份
@ ECHO.-------------------------------------------------------------------------------
call %Global_Bat_HOME%\sub_clear\sub_delete_databackup.bat
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.				开始清除SAP日志备份
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.-------------------------------------------------------------------------------
call %Global_Bat_HOME%\sub_clear\sub_delete_archivebackup.bat
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.				开始检查磁盘剩余空间
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.-------------------------------------------------------------------------------
Rem ---------------判断剩余空间是否足够,如不足够,多清除一天数据-----------------------

REM call %Global_Bat_HOME%\sub_comm\sub_check_del_morday.bat sub_delete_databackup.bat
call %Global_Bat_HOME%\sub_comm\sub_check_disk_space.bat
echo %Local_Checkdisk_DiskSpace%
Rem ----------------------------------------------------------------------------------
@ ECHO.				以上代码清除备份数据
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.--------------------------下面开始备份数据-------------------------------------
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.-------------------------------------------------------------------------------
Rem ----------------------------------------------------------------------------------
Rem ----------------------------------------------------------------------------------
Rem ----------------------------------------------------------------------------------
Rem ----------------------------------------------------------------------------------
Rem ----------------------------------------------------------------------------------
Rem -----------------------------  选择介质连接  -------------------------------------  

REM if %Global_Media_Type%==DISK (echo DISK) else (if %Global_Media_Type%==NFS ( call %Global_Bat_HOME%\sub_comm\sub_mount_nfs.bat) else (if %Global_Media_Type%==ISCSI (echo ISCSI) else (if %Global_Media_Type%==FTP (echo FTP) else (echo @@ )) ) )

Rem ----------------------------------------------------------------------------------
Rem ----------------------------------------------------------------------------------
Rem ----------------------------------------------------------------------------------

@ ECHO.--------------------------备份数据中-------------------------------------------
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.-------------------------------------------------------------------------------
@ ECHO.-------------------------------------------------------------------------------
REM call %Global_Bat_HOME%\sub_backup\oracle_exp.bat


Rem ------------------------------  备份完成结束连接  --------------------------------  
umount -a -f
Rem ----------------------------------------------------------------------------------
Rem ----------------------------------------------------------------------------------
Rem ----------------------------------------------------------------------------------


if exist  %Global_Bat_HOME%\log\erro.log (blat %Global_Bat_HOME%\log\erro.log -to %Global_Mail_Remail% -charset %Global_Mail_Unicode% -subject %Global_Mail_Title% -server %Global_Mail_Smtp% -f %Global_Mail_User% -u %Global_Mail_User% -pw %Global_Mail_Pwd% && del %Global_Bat_HOME%\log\erro.log && echo 错误日志发送成功) else (echo 完成作业！！)
















